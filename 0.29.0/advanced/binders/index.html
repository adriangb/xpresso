
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Developer centric, performant and extensible ASGI framework">
      
      
      
        <link rel="canonical" href="https://www.xpresso-api.dev/0.29.0/advanced/binders/">
      
      <link rel="icon" href="../../assets/images/xpresso-bean.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.5">
    
    
      
        <title>Binders - Xpresso</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="amber">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#binders" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../.."> <!--  -->
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Xpresso" class="md-header__button md-logo" aria-label="Xpresso" data-md-component="logo">
      
  <img src="../../assets/images/xpresso-bean.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Xpresso
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Binders
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/adriangb/xpresso/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    adriangb/xpresso
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Xpresso" class="md-nav__button md-logo" aria-label="Xpresso" data-md-component="logo">
      
  <img src="../../assets/images/xpresso-bean.png" alt="logo">

    </a>
    Xpresso
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/adriangb/xpresso/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    adriangb/xpresso
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Xpresso
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../types/" class="md-nav__link">
        Python Types
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Tutorial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorial" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorial
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/minimal_app/" class="md-nav__link">
        Minimal App
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/path_params/" class="md-nav__link">
        Path Parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/query_params/" class="md-nav__link">
        Query Parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/param_constraints_and_metadata/" class="md-nav__link">
        Parameter Constraints and Metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/body/" class="md-nav__link">
        Request Body
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/cookie_params/" class="md-nav__link">
        Cookie Parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/header_params/" class="md-nav__link">
        Header Parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/files/" class="md-nav__link">
        File Uploads
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/forms/" class="md-nav__link">
        Forms
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_10" type="checkbox" id="__nav_3_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_10">
          Dependencies
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Dependencies" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_10">
          <span class="md-nav__icon md-icon"></span>
          Dependencies
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/dependencies/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/dependencies/nested/" class="md-nav__link">
        Nested Dependencies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/dependencies/lifecycle/" class="md-nav__link">
        Dependency Lifecycle
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/dependencies/http-params/" class="md-nav__link">
        HTTP Parameter Dependencies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/dependencies/scopes/" class="md-nav__link">
        Scopes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/dependencies/shared/" class="md-nav__link">
        Shared Dependencies
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_11" type="checkbox" id="__nav_3_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_11">
          Middleware
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Middleware" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_11">
          <span class="md-nav__icon md-icon"></span>
          Middleware
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/middleware/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/lifespan/" class="md-nav__link">
        Lifespans
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/routing/" class="md-nav__link">
        Routing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Advanced Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advanced Usage" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Advanced Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../websockets/" class="md-nav__link">
        WebSockets
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Dependencies
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Dependencies" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Dependencies
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dependencies/performance/" class="md-nav__link">
        Performance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dependencies/caching/" class="md-nav__link">
        Caching
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dependencies/responses/" class="md-nav__link">
        Accessing Responses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dependencies/overrides/" class="md-nav__link">
        Dependency Overrides
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Binders
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Binders
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    Architecture
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#markers" class="md-nav__link">
    Markers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-binders-messagepack-body" class="md-nav__link">
    Custom Binders: MessagePack body
  </a>
  
    <nav class="md-nav" aria-label="Custom Binders: MessagePack body">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tests" class="md-nav__link">
    Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extractor" class="md-nav__link">
    Extractor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openapiprovider" class="md-nav__link">
    OpenAPIProvider
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#putting-it-all-together" class="md-nav__link">
    Putting it all together
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-tests" class="md-nav__link">
    Run the tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../proxies-root-path/" class="md-nav__link">
        Proxies and URL paths
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    Architecture
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#markers" class="md-nav__link">
    Markers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-binders-messagepack-body" class="md-nav__link">
    Custom Binders: MessagePack body
  </a>
  
    <nav class="md-nav" aria-label="Custom Binders: MessagePack body">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tests" class="md-nav__link">
    Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extractor" class="md-nav__link">
    Extractor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openapiprovider" class="md-nav__link">
    OpenAPIProvider
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#putting-it-all-together" class="md-nav__link">
    Putting it all together
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-tests" class="md-nav__link">
    Run the tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/adriangb/xpresso/blob/main/docs/advanced/binders.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



<h1 id="binders">Binders</h1>
<p>One of the core principles of Xpresso is that the framework does not get any special treatment.
While it is not always possible (or worth it) to make everything customizable, by ensuring that we do not special case our own implementations we allow you, the developer, to have the ability to implement things that would otherwise have to be feature requests.
This way everyone wins: we have less features to mantain, less edge cases to test and you get to make Xpresso work for your use case.</p>
<p>Binders are a great example of this philosophy.
They are how Xpresso interally processes request bodies, forms and parameters (cookies, headers, etc.).
It is also how most of the OpenAPI documentation is generated.
In fact, all of <code>FromQuery</code>/<code>QueryParam(...)</code>, <code>FromMultipart</code>/<code>Multipart(...)</code> and others are just a particular implementation of a Binder.</p>
<p>In this tutorial we will dive in depth into Binders, and by the end of it we will have built a custom binder that parses MessagePack requests bodies into a Pydantic model.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Binders are inspired by <a href="https://github.com/Neoteroi/BlackSheep">BlackSheep</a> and <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-6.0">ASP.NET Core</a>.
Integration into the dependency injection system is inspired by <a href="https://fastapi.tiangolo.com">FastAPI</a>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Experimental APIs</p>
<p>The APIs for Binders are considered experimental.
We encourage exploration and experimentation, but can't promise long term stability.</p>
</div>
<h2 id="architecture">Architecture</h2>
<p>First, a word on how Binders work.
Binders leverage the dependency injection system.
They are themselves dependencies that your endpoint function (or other dependencies) will depend on.
And then they themselves depend on the incoming <code>Request</code> object in the case of body extractors or <code>HTTPConnection</code> in the case of parameters.</p>
<p>Binders also have a dual purpose:</p>
<ol>
<li>They extract data (<strong>Extractor</strong>)</li>
<li>They generate OpenAPI specs (<strong>OpenAPIProvider</strong>s)</li>
</ol>
<p>Each one of these two functionalities has it's own protocol/interface that Binders must implement.</p>
<h2 id="markers">Markers</h2>
<p>Because the same binder object can be used with multiple parameters (think about how <code>FromJson</code> is an alias for <code>Annotated[..., Json()]</code>; the <code>Json()</code> object will be the same in everywhere <code>FromJson</code> is used) it cannot be modified in-place to record information from the parameter it is being bound to (think for example how <code>FromQuery</code> automatically gets the query parameter name from the the Python parameter name and the type to parse into from the type annotation).</p>
<p>To get around this issue, we have the concept of <code>Markers</code>.
Markers are usually just data containers that when bound to a Python parameter (an <code>inspect.Parameter</code> instance in fact) will produce a unique Extractor and OpenAPIProvider instance.</p>
<p>Since we already had two interfaces to implement (Extractor and OpenAPIProvider) and each one needs a Marker, typically we will be implementing <strong>4 different protocols/interfaces for each Binder</strong>:</p>
<ol>
<li><code>OpenAPI{Body,Parameter}Marker</code></li>
<li><code>OpenAPI{Body,Parameter}</code></li>
<li><code>{Body,Parameter}ExtractorMarker</code></li>
<li><code>{Body,Parameter}Extractor</code></li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This is already a lot of information.
Before trying to implement your own marker, you may want to look at the source code for <code>FromJson</code> to see how a Binder you are already familiar with is implemented.</p>
</div>
<h2 id="custom-binders-messagepack-body">Custom Binders: MessagePack body</h2>
<p>In this tutorial we will be implementing a custom binder that extracts <a href="https://msgpack.org/index.html">MessagePack</a> request bodies into Pydantic models.</p>
<p>Start by making a folder to organize your work and adding an <code>__init__.py</code> file.
We will be putting several Python files in this folder.</p>
<h3 id="tests">Tests</h3>
<p>Like any good TDD'er, we'll write some tests first.
This will also help you, the reader, understand what the expected outcome is.
First, we need to define an app.
Create a file called <code>tests.py</code> with the following contents:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span>

<span class="kn">import</span> <span class="nn">msgpack</span>  <span class="c1"># type: ignore[import]</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span> <span class="nn">xpresso</span> <span class="kn">import</span> <span class="n">App</span><span class="p">,</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">xpresso.testclient</span> <span class="kn">import</span> <span class="n">TestClient</span>

<span class="kn">from</span> <span class="nn">.functions</span> <span class="kn">import</span> <span class="n">FromMsgPack</span>


<span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">echo_item</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">FromMsgPack</span><span class="p">[</span><span class="n">Item</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Item</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">item</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">App</span><span class="p">(</span>
    <span class="n">routes</span><span class="o">=</span><span class="p">[</span>
        <span class="n">Path</span><span class="p">(</span>
            <span class="s2">&quot;/echo-item&quot;</span><span class="p">,</span>
            <span class="n">put</span><span class="o">=</span><span class="n">echo_item</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_echo_item</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="s2">&quot;abc&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">}</span>
    <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">msgpack</span><span class="o">.</span><span class="n">packb</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>  <span class="c1"># type: ignore[assignment]</span>

    <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;/echo-item&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">content</span>
    <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">==</span> <span class="n">payload</span>


<span class="k">def</span> <span class="nf">test_openapi_schema</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">expected_openapi</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;openapi&quot;</span><span class="p">:</span> <span class="s2">&quot;3.0.3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;API&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">},</span>
        <span class="s2">&quot;paths&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;/echo-item&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;put&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;responses&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;200&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Successful Response&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;application/json&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="s2">&quot;$ref&quot;</span><span class="p">:</span> <span class="s2">&quot;#/components/schemas/Item&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;422&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Validation Error&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;application/json&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="s2">&quot;$ref&quot;</span><span class="p">:</span> <span class="s2">&quot;#/components/schemas/HTTPValidationError&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                        <span class="p">},</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;requestBody&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;application/x-msgpack&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;binary&quot;</span><span class="p">,</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;components&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;schemas&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;Item&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Item&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Foo&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">},</span>
                        <span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Bar&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">},</span>
                    <span class="p">},</span>
                <span class="p">},</span>
                <span class="s2">&quot;ValidationError&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;ValidationError&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;loc&quot;</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Location&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;array&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;oneOf&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">},</span>
                                    <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">},</span>
                                <span class="p">]</span>
                            <span class="p">},</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Message&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">},</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Error Type&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">},</span>
                <span class="p">},</span>
                <span class="s2">&quot;HTTPValidationError&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;HTTPValidationError&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;detail&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Detail&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;array&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;$ref&quot;</span><span class="p">:</span> <span class="s2">&quot;#/components/schemas/ValidationError&quot;</span>
                            <span class="p">},</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                <span class="p">},</span>
            <span class="p">}</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/openapi.json&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">content</span>
    <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">==</span> <span class="n">expected_openapi</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test_echo_item</span><span class="p">()</span>
    <span class="n">test_openapi_schema</span><span class="p">()</span>
</code></pre></div>
<p>At this point we would have just stubbed out the actual implementations (just <code>FromMsgPack</code> for now, something like <code>FromMsgPack = Annotated[T, "placeholder"]</code> would do).
So go ahead and create a file called <code>functions.py</code> and add a stub for <code>FromMsgPack</code>.</p>
<p>But if we run our tests (<code>pytest tests.py</code>) they fail.
So we need to actually cook up the implementations next.</p>
<h3 id="extractor">Extractor</h3>
<p>We'll start with the extractors.
Make a file called <code>extractor.py</code> with the following contents:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">Type</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">get_args</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">get_args</span>

<span class="kn">import</span> <span class="nn">msgpack</span>  <span class="c1"># type: ignore[import]</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span> <span class="nn">xpresso</span> <span class="kn">import</span> <span class="n">Request</span>
<span class="kn">from</span> <span class="nn">xpresso.binders.api</span> <span class="kn">import</span> <span class="n">SupportsBodyExtractor</span>
<span class="kn">from</span> <span class="nn">xpresso.requests</span> <span class="kn">import</span> <span class="n">HTTPConnection</span>


<span class="k">class</span> <span class="nc">MsgPackBodyExtractor</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">:</span> <span class="n">HTTPConnection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">Request</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">connection</span><span class="o">.</span><span class="n">body</span><span class="p">()</span>
        <span class="n">deserialized_obj</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">msgpack</span><span class="o">.</span><span class="n">unpackb</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># type: ignore[assignment]</span>
        <span class="c1"># You probably want more checks and validation here</span>
        <span class="c1"># For example, handling empty bodies</span>
        <span class="c1"># This is just a tutorial!</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parse_obj</span><span class="p">(</span><span class="n">deserialized_obj</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MsgPackBodyExtractorMarker</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">register_parameter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SupportsBodyExtractor</span><span class="p">:</span>
        <span class="c1"># get the first paramater to Annotated, which should be our actual type</span>
        <span class="n">model</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">get_args</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">annotation</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">):</span>
            <span class="c1"># You may want more rigourous checks here</span>
            <span class="c1"># Or you may want to accept non-Pydantic models</span>
            <span class="c1"># We do the easiest thing here</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;MessagePack model must be a Pydantic model&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">MsgPackBodyExtractor</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>All of these base classes are <code>typing.Protocol</code> classes.
This means you do not actually have to inherit from them directly to implement them.
But it can be helpful to do so to get IDE autocompletion on method signatures as you implement them.</p>
</div>
<h3 id="openapiprovider">OpenAPIProvider</h3>
<p>This OpenAPIProvider will be somewhat anemic: there isn't much we can describe about MessagePack to OpenAPI other than the expected media type and that it will be binary data.
Make a file called <code>openapi.py</code> with the following contents:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">typing</span>

<span class="kn">from</span> <span class="nn">xpresso.binders.api</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ModelNameMap</span><span class="p">,</span>
    <span class="n">Schemas</span><span class="p">,</span>
    <span class="n">SupportsOpenAPIBody</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">xpresso.openapi</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">OpenAPIBodyMsgPack</span><span class="p">:</span>
    <span class="n">include_in_schema</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">media_type</span> <span class="o">=</span> <span class="s2">&quot;application/x-msgpack&quot;</span>

    <span class="k">def</span> <span class="nf">get_models</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">type</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_openapi_media_type</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model_name_map</span><span class="p">:</span> <span class="n">ModelNameMap</span><span class="p">,</span> <span class="n">schemas</span><span class="p">:</span> <span class="n">Schemas</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">models</span><span class="o">.</span><span class="n">MediaType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">MediaType</span><span class="p">(</span>
            <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_field_schema</span><span class="p">(</span><span class="n">model_name_map</span><span class="p">,</span> <span class="n">schemas</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_field_schema</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model_name_map</span><span class="p">:</span> <span class="n">ModelNameMap</span><span class="p">,</span> <span class="n">schemas</span><span class="p">:</span> <span class="n">Schemas</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">models</span><span class="o">.</span><span class="n">Schema</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_openapi_body</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model_name_map</span><span class="p">:</span> <span class="n">ModelNameMap</span><span class="p">,</span> <span class="n">schemas</span><span class="p">:</span> <span class="n">Schemas</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">models</span><span class="o">.</span><span class="n">RequestBody</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">RequestBody</span><span class="p">(</span>
            <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_openapi_media_type</span><span class="p">(</span>
                    <span class="n">model_name_map</span><span class="p">,</span> <span class="n">schemas</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_field_encoding</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model_name_map</span><span class="p">:</span> <span class="n">ModelNameMap</span><span class="p">,</span> <span class="n">schemas</span><span class="p">:</span> <span class="n">Schemas</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">models</span><span class="o">.</span><span class="n">Encoding</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">Encoding</span><span class="p">(</span><span class="n">contentType</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">media_type</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">OpenAPIBodyMarkerMsgPack</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">register_parameter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SupportsOpenAPIBody</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">OpenAPIBodyMsgPack</span><span class="p">()</span>
</code></pre></div>
<p>You may notice that there are several pointless methods here that could have all been stuck into <code>get_openapi()</code>.
These aren't strictly necessary here, but would be used if we tried to use this Binder as form field in a <code>multipart/form-data</code> request, so we are showing them to you just in case.</p>
<h3 id="putting-it-all-together">Putting it all together</h3>
<p>Now we just need some sugar so we can call a single function and have it wire all of this stuff up.
Open <code>functions.py</code>, remove your <code>FromMsgPack</code> stub and add:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="kn">from</span> <span class="nn">xpresso.binders.dependants</span> <span class="kn">import</span> <span class="n">BodyBinderMarker</span>
<span class="kn">from</span> <span class="nn">xpresso.typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">.extractor</span> <span class="kn">import</span> <span class="n">MsgPackBodyExtractorMarker</span>
<span class="kn">from</span> <span class="nn">.openapi</span> <span class="kn">import</span> <span class="n">OpenAPIBodyMarkerMsgPack</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">MsgPack</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">BodyBinderMarker</span><span class="p">(</span>
        <span class="n">extractor_marker</span><span class="o">=</span><span class="n">MsgPackBodyExtractorMarker</span><span class="p">(),</span>
        <span class="n">field_extractor_marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">openapi_marker</span><span class="o">=</span><span class="n">OpenAPIBodyMarkerMsgPack</span><span class="p">(),</span>
        <span class="n">openapi_field_marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>


<span class="n">FromMsgPack</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">MsgPack</span><span class="p">()]</span>
</code></pre></div>
<p>You don't have to worry much about <code>BodyBinderMarker</code>.
It's just a helper class that takes care of the interaction with the dependency injection system.</p>
<h3 id="run-the-tests">Run the tests</h3>
<p>That's it!
Now you can run the tests (<code>pytest tests.py</code>) and they should pass!</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../dependencies/overrides/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Dependency Overrides" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Dependency Overrides
            </div>
          </div>
        </a>
      
      
        
        <a href="../proxies-root-path/" class="md-footer__link md-footer__link--next" aria-label="Next: Proxies and URL paths" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Proxies and URL paths
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.bd0b6b67.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.467223ff.min.js"></script>
      
    
  </body>
</html>